const INSTALINKS_STYLES = `body{display:flex;flex-direction:column}.main-content{display:flex;flex-direction:column;justify-content:space-between}.feed-list{display:flex;flex-flow:row wrap}.feed-item{display:flex;flex-direction:column}.load-button{font-family:futura-pt,sans-serif;font-style:normal;font-weight:600;text-transform:uppercase;letter-spacing:.1em;font-size:12px;background-color:#f7ce00;border:0;width:126px;height:47px;text-align:center;border-radius:50px;color:white}.load-button[disabled="disabled"]{color:black;background-color:grey}.load-button:hover:not([disabled="disabled"]){box-shadow:inset 0 0 100px 100px rgba(255,255,255,0.3)}@media(min-width:100px){.feed-image{width:100%}.feed-list{flex-direction:column}}@media(min-width:319px){.feed-item{margin:10px;flex:1 0 150px;max-width:400px}.feed-list{flex-direction:row}.ghost{flex:1 0 150px}}@media(min-width:650px){.feed-item{margin:10px;flex:1 0 250px;max-width:400px}.feed-list{flex-direction:row}.ghost{flex:1 0 250px}}.ghost{height:0;margin-top:0;margin-bottom:0}
`

class Instalinks{constructor(a){this._addLibraries(),this.feed=this._createFeed(a),this.data=[]}static get linkRegex(){const a=/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,b=new RegExp(a);return b}static get tagTemplate(){return`<div class="feed-item">
                    <a class="feed-link" id="{{model.id}}" href="">
                        <img class="feed-image" src="{{image}}"></img>
                    </a>
                </div>`}static get linkTemplate(){return`<div class="feed-item">
                    <a class="feed-link" id="{{model.id}}" href="">
                        <img class="feed-image" src="{{image}}"></img>
                    </a>
                </div>`}run(){this.insert(),this.feed.run()}_addLibraries(){if(!document.getElementById("instalinks-styles")){const a=document.createElement("style");a.type="text/css",a.id="instalinks-styles",a.innerHTML=INSTALINKS_STYLES,document.head.appendChild(a)}}_createFeed(a){const b=this,c={LINK:1,TAG:2,NONE:3};let d=null,e=null;a.template?(d=c.NONE,e=a.template):a.tagName?(d=c.TAG,e=Instalinks.tagTemplate):(d=c.LINK,e=Instalinks.linkTemplate),a.template=e,a.filter||(d===c.LINK?a.filter=function(a){const c=b.data.filter(b=>b.image.id==a.id)[0];return 0<c.parsedLinks.length}:d===c.TAG&&(a.filter=function(b){return 0<=b.tags.indexOf(a.tagName)}));const f=Object.assign({},a,{get:"user",sortBy:"most-recent",useHttp:!0,resolution:"standard_resolution"});return f.success=function(c){a.success&&a.success(c);const d=c.data.map(a=>{let b=[];return a.caption&&a.caption.text&&b.push(...a.caption.text.match(Instalinks.linkRegex)),b=b.map(a=>a.startsWith("http")?a:"http://"+a),{parsedLinks:b,image:a}});b.data.push(...d)},f.after=function(){a.after&&a.after();const e=document.getElementById("load");if(this.hasNext()||e.setAttribute("disabled","disabled"),d!==c.LINK)return;b.data.forEach(a=>{if(0===a.parsedLinks.length)return;const b=a.image.id,c=document.getElementById(b);c.href=a.parsedLinks[0]});const f=document.getElementById("instafeed"),g=f.querySelectorAll(".feed-item"),h=f.querySelectorAll(".ghost"),i=2*g.length+1,j=i-h.length;console.log(f,g,h,i,j);for(let a=0;a<j;a++){const a=document.createElement("div");a.className="ghost",f.appendChild(a)}},new Instafeed(f)}insert(){const a=document.getElementById("instalinks");a.innerHTML=`
            <div id="instafeed" class="feed-list"></div>
            <button class="load-button" id="load" type="button">Load More</button>`;const b=document.getElementById("load");b.addEventListener("click",()=>this.feed.next())}}
